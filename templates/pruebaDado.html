<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Dado D12 con valores</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin: 0; overflow: hidden; background: #ffffff; }
    canvas { display: block; }
    #ui {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #222;
      color: #fff;
    }
    button:hover { background: #444; }
    #result {
      margin-top: 10px;
      font-size: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="ui">
    <button id="roll">üé≤ Tirar D12</button>
    <div id="result"></div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
<script>
  // --- Escena ---
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0xffffff);

  const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 100);
  camera.position.set(2, 2, 4);

  const renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  renderer.shadowMap.type = THREE.PCFSoftShadowMap;
  document.body.appendChild(renderer.domElement);

  // --- Luces ---
  scene.add(new THREE.AmbientLight(0xffffff, 0.4));

  const dir = new THREE.DirectionalLight(0xffffff, 1);
  dir.position.set(0, 5, 0); // directamente arriba
  dir.castShadow = true;
  dir.shadow.mapSize.width = 1024;
  dir.shadow.mapSize.height = 1024;
  scene.add(dir);

  // --- Geometr√≠a del D12 ---
  const geo = new THREE.DodecahedronGeometry(1);
  const material = new THREE.MeshPhongMaterial({
    color: 0x222222,
    shininess: 100,
    flatShading: true
  });
  const dice = new THREE.Mesh(geo, material);
  dice.castShadow = true;
  dice.receiveShadow = true;
  scene.add(dice);

  // --- Suelo ---
  const planeGeo = new THREE.PlaneGeometry(10, 10);
  const planeMat = new THREE.ShadowMaterial({ opacity: 0.3 });
  const plane = new THREE.Mesh(planeGeo, planeMat);
  plane.rotation.x = -Math.PI / 2;
  plane.position.y = -1.2;
  plane.receiveShadow = true;
  scene.add(plane);

  // --- Controles ---
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  // --- Valores de las 12 caras ---
  const faceValues = [
    "Jos√©", "Mar√≠a", "Ricardo", "Ana",
    "Luis", "Carmen", "Pedro", "Sof√≠a",
    "Miguel", "Laura", "Andr√©s", "Elena"
  ];

  // --- Animaci√≥n ---
  let rolling = false;
  let rollSpeed = 0;

  function animate() {
    requestAnimationFrame(animate);

    if (rolling) {
      dice.rotation.x += rollSpeed * 0.02;
      dice.rotation.y += rollSpeed * 0.025;
      dice.rotation.z += rollSpeed * 0.018;
      rollSpeed *= 0.96; // fricci√≥n

      if (rollSpeed < 0.01) {
        rolling = false;

        // --- Selecci√≥n de cara aleatoria ---
        const faceIndex = Math.floor(Math.random() * 12);
        document.getElementById("result").innerText =
          "Resultado: " + faceValues[faceIndex];

        // --- Alinear el dado a esa cara ---
        const normal = new THREE.Vector3();
        geo.computeFaceNormals();
        normal.copy(geo.faces[faceIndex].normal);

        // giramos el dado para que esa cara mire hacia arriba
        const up = new THREE.Vector3(0, 1, 0);
        const q = new THREE.Quaternion().setFromUnitVectors(normal, up);
        dice.setRotationFromQuaternion(q);
      }
    }

    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  // --- Tirar el dado ---
  document.getElementById("roll").addEventListener("click", () => {
    rolling = true;
    rollSpeed = 2 + Math.random() * 4; // velocidad inicial aleatoria
    document.getElementById("result").innerText = "";
  });

  // --- Resize ---
  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>
</body>
</html>
